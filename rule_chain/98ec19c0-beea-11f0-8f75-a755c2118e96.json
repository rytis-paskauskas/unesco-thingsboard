{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : "Author: Rytis Paškauskas"
    },
    "configuration" : null,
    "debugMode" : true,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "99003e03-beea-11f0-8f75-a755c2118e96"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "98ec19c0-beea-11f0-8f75-a755c2118e96"
    },
    "name" : "Barani Meteo Rain decoder",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Post attributes"
    }, {
      "fromIndex" : 2,
      "toIndex" : 3,
      "type" : "RPC Request from Device"
    }, {
      "fromIndex" : 2,
      "toIndex" : 4,
      "type" : "Other"
    }, {
      "fromIndex" : 2,
      "toIndex" : 5,
      "type" : "RPC Request to Device"
    }, {
      "fromIndex" : 2,
      "toIndex" : 10,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 2,
      "toIndex" : 11,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 6,
      "toIndex" : 2,
      "type" : "False"
    }, {
      "fromIndex" : 6,
      "toIndex" : 7,
      "type" : "True"
    }, {
      "fromIndex" : 6,
      "toIndex" : 15,
      "type" : "False"
    }, {
      "fromIndex" : 6,
      "toIndex" : 15,
      "type" : "True"
    }, {
      "fromIndex" : 6,
      "toIndex" : 18,
      "type" : "False"
    }, {
      "fromIndex" : 6,
      "toIndex" : 18,
      "type" : "True"
    }, {
      "fromIndex" : 7,
      "toIndex" : 2,
      "type" : "False"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "True"
    }, {
      "fromIndex" : 8,
      "toIndex" : 2,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 6,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 17,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 12,
      "type" : "True"
    }, {
      "fromIndex" : 12,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 13,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 15,
      "toIndex" : 16,
      "type" : "Failure"
    }, {
      "fromIndex" : 16,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 20,
      "type" : "Failure"
    }, {
      "fromIndex" : 17,
      "toIndex" : 20,
      "type" : "Success"
    }, {
      "fromIndex" : 18,
      "toIndex" : 19,
      "type" : "Failure"
    }, {
      "fromIndex" : 19,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 20,
      "toIndex" : 21,
      "type" : "Success"
    }, {
      "fromIndex" : 20,
      "toIndex" : 23,
      "type" : "Success"
    }, {
      "fromIndex" : 20,
      "toIndex" : 27,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 22,
      "type" : "True"
    }, {
      "fromIndex" : 22,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 23,
      "toIndex" : 24,
      "type" : "True"
    }, {
      "fromIndex" : 24,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 25,
      "toIndex" : 26,
      "type" : "Success"
    }, {
      "fromIndex" : 26,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 27,
      "toIndex" : 13,
      "type" : "False"
    }, {
      "fromIndex" : 27,
      "toIndex" : 25,
      "type" : "True"
    } ],
    "firstNodeIndex" : 9,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1679,
        "layoutY" : 352
      },
      "configuration" : {
        "defaultTTL" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1765214575757,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "990016f0-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Save Timeseries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1030,
        "layoutY" : 703
      },
      "configuration" : {
        "scope" : "SERVER_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : false
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764495866850,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "990016f1-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Save Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 452,
        "layoutY" : 354
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762029314031,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "990016f2-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Message Type Switch",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 645,
        "layoutY" : 89
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "990016f3-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Log RPC from Device",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 366,
        "layoutY" : 54
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "990016f4-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Log Other",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 609,
        "layoutY" : 21
      },
      "configuration" : {
        "timeoutInSeconds" : 60
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "990016f5-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "RPC Call Request",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rpc.TbSendRPCRequestNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 52,
        "layoutY" : 355
      },
      "configuration" : {
        "originatorTypes" : [ "ENTITY_GROUP" ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1761638609484,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99003e00-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Is Entity Group",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbOriginatorTypeFilterNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 253,
        "layoutY" : 479
      },
      "configuration" : {
        "messageTypes" : [ "POST_ATTRIBUTES_REQUEST", "RPC_CALL_FROM_SERVER_TO_DEVICE" ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1761638609484,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99003e01-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Post attributes or RPC request",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeFilterNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 505,
        "layoutY" : 478
      },
      "configuration" : {
        "entityGroupId" : null,
        "entityGroupIsMessageOriginator" : true
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1761638609484,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99003e02-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Duplicate To Group Entities",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbDuplicateMsgToGroupNode"
    }, {
      "additionalInfo" : {
        "description" : "Process incoming messages from devices with the alarm rules defined in the device profile. Dispatch all incoming messages with \"Success\" relation type.",
        "layoutX" : 51,
        "layoutY" : 255
      },
      "configuration" : {
        "persistAlarmRulesState" : false,
        "fetchAlarmRulesStateOnStart" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1761638609484,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99003e03-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Device Profile Node",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.profile.TbDeviceProfileNode"
    }, {
      "additionalInfo" : {
        "description" : "\nTranscribed to TBEL from https://github.com/Milesight-IoT/SensorDecoders/blob/main/ft-series/ft101/ft101-decoder.js\n",
        "layoutX" : 778,
        "layoutY" : 249
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "var decoded = {};\nvar b64 = msg.data;\n\n// Base64 → binary string\nvar binaryStr = atob(b64);\n\n// Binary string → byte array\nvar bytes = new Uint8Array(binaryStr.length);\nfor (var i = 0; i < binaryStr.length; i++) {\n    bytes[i] = binaryStr.charCodeAt(i) & 0xFF;\n}\n\ndecoded.bytes= bytes;\n\n\nreturn {msg: decoded, metadata: metadata, msgType: msgType};",
        "tbelScript" : "// {\"data\": \"bxeAAqUtgAAAXf8=\", \"fport\": 1}\n// {\"data\": \"uQA4AATQ\",\"fport\": 1}\n// {\"deviceName\": \"2502LR003\",\"deviceType\": \"Barani MeteoRain\",\"ss_commonName\": \"2502LR003\",\"ts\":\"1763478171500\"}\n\n\nvar decoded = decodeToJson(\"{}\");\n\n\n// ---------- Stateful BitReader (MSB-first) for base64 payloads ----------\n// Keeps reading position between bitReader() calls within same script execution.\n\nvar __br_bytes = null;   // Uint8Array of payload bytes\nvar __br_bitPos = 0;     // Bit position within the stream\n\n// Initialize the reader with base64 payload string.\n// Returns total bits available.\nfunction bitReaderInit(b64) {\n    __br_bytes = base64ToBytes(b64);  // ThingsBoard TBEL built-in\n    __br_bitPos = 0;\n    return __br_bytes.length * 8;\n}\n\n// Read N bits from LEFT (MSB-first) and return as unsigned integer\nfunction bitReader(N) {\n    if (__br_bytes == null) {\n        throw \"bitReaderInit() must be called first.\";\n    }\n    if (N <= 0) return 0;\n\n    var totalBits = __br_bytes.length * 8;\n    if (__br_bitPos + N > totalBits) {\n        throw \"Not enough bits remaining: requested \" + N + \", available \" + (totalBits - __br_bitPos);\n    }\n\n    var value = 0;\n    for (var i = 0; i < N; i++) {\n        var bitIndex  = __br_bitPos;\n        var byteIndex = bitIndex >> 3;\n        var bitInByte = 7 - (bitIndex & 7);    // MSB-first\n        var byteVal   = __br_bytes[byteIndex];\n        var bit       = (byteVal >> bitInByte) & 1;\n\n        value = (value << 1) | bit;\n        __br_bitPos = __br_bitPos + 1;\n    }\n\n    return value >>> 0; // unsigned\n}\n\nfunction bitsRemaining() {\n    if (__br_bytes == null) return 0;\n    return __br_bytes.length * 8 - __br_bitPos;\n}\n\nfunction round1(x) {\n    return Math.round(x * 10) / 10.0;\n}\n\nfunction round2(x) {\n    return Math.round(x * 100) / 100.0;\n}\n\n// ==== main body ===\nvar totalBits = bitReaderInit(msg.data);\nvar index = bitReader(8);\nvar battery_bit = bitReader(1);\n// battery indicator\n\nvar rc = bitReader(12); // rain counter\nvar tim = bitReader(10);\nvar time_bt = 0.0;\nif (tim>0) {\n    time_bt = (728.0 / tim);\n    time_bt = time_bt*time_bt;\n}\nvar rcc = bitReader(12);\nvar temp = bitReader(1);\nvar debug = bitReader(1);\n//var rc_dif = rc - metadata.rc_last;\n//if (rc_dif < 0) {\n//    rc_dif += 4096;\n//}\n//var rcc_dif = rcc - metadata.rcc_last;\n//if (rcc_dif < 0) {\n//    rcc_dif += 4096;\n//}\n\nreturn {\n    msg: {\n        //type: type,\n        //batt: batt,\n        //bits: totalBits,\n        rc: rc,\n        rcc: rcc,\n        rct: time_bt\n        \n    },\n    metadata: metadata,\n    msgType: msgType\n};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1766998970375,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99003e04-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "decode base64",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 778,
        "layoutY" : 353
      },
      "configuration" : {
        "messageNames" : [ "attributes" ],
        "metadataNames" : [ ],
        "checkAllKeys" : true
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1765214726907,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99006510-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "got attribute data?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbCheckMessageNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 779,
        "layoutY" : 458
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "var attrMsg = {};\nif (msg.attributes != null) {\n    attrMsg = msg.attributes;\n}\n//attrMsg.put('inactivityTimeout', 3660000);\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: attrMsg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762025123492,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99006511-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "prepare attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1677,
        "layoutY" : 253
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "if (msg.attributes != null) {\n    msg.remove(\"attributes\");\n}\nif (msg.info != null) {\n    msg.remove(\"info\");\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1766999282565,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99006512-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Clean up telemetry",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1677,
        "layoutY" : 455
      },
      "configuration" : {
        "event" : "ACTIVITY_EVENT"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1761642147056,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99006513-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "Make it active",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbDeviceStateNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 72,
        "layoutY" : 706
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "latestTsKeyNames" : [ ],
        "serverAttributeNames" : [ "inactivityTimeout" ],
        "sharedAttributeNames" : [ ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764239691171,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99006514-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "test for inactivityTimeout",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 421,
        "layoutY" : 704
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "msg={'inactivityTimeout':3660000};\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n//return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764239691171,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99006515-beea-11f0-8f75-a755c2118e96"
      },
      "name" : "set inactivity timeout",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 902,
        "layoutY" : 129
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ "rc", "rcc" ],
        "latestTsKeyNames" : [ ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1766998970375,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3a3072e0-cca1-11f0-8f75-a755c2118e96"
      },
      "name" : "old counters",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 5,
        "layoutY" : 605
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ "slope", "intercept" ],
        "latestTsKeyNames" : [ ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "9cea09e0-cd65-11f0-8f75-a755c2118e96"
      },
      "name" : "scaling attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 429,
        "layoutY" : 599
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "msg={'slope':0.2, 'intercept':0.0};\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "9cea30f0-cd65-11f0-8f75-a755c2118e96"
      },
      "name" : "default linear coefficients",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1027,
        "layoutY" : 254
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "var r = 0.0;\nvar dif1 = 0.0;\nvar dif2 = 0.0;\nif ((metadata.ss_rc != null) && (msg.rc!=metadata.ss_rc)) {\n    dif1 = msg.rc - metadata.ss_rc;\n    if (dif1 < 0) dif1 += 4096;\n}\n\nif ((metadata.ss_rcc != null) && (msg.rcc!=metadata.ss_rcc)) {\n    dif2 = msg.rcc - metadata.ss_rcc;\n    if (dif2 < 0) dif2 += 4096;\n}\n\nmsg.r = 1.0*dif1 + 0.01*dif2;\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1766998907997,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f587bcf0-cd65-11f0-8f75-a755c2118e96"
      },
      "name" : "calculate non-scaled rainfall",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1025,
        "layoutY" : 355
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.rc != metadata.ss_rc;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1765214305926,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "760c73d0-cdce-11f0-8f75-a755c2118e96"
      },
      "name" : "rc has changed",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 455
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "msg={'rc':msg.rc};\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764495855790,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "760c73d1-cdce-11f0-8f75-a755c2118e96"
      },
      "name" : "remember rc as attribute",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1328,
        "layoutY" : 353
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.rcc != metadata.ss_rcc;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1765214305926,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "760c9ae0-cdce-11f0-8f75-a755c2118e96"
      },
      "name" : "rcc has changed",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1327,
        "layoutY" : 454
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "msg={'rcc':msg.rcc};\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764496078401,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "760c9ae1-cdce-11f0-8f75-a755c2118e96"
      },
      "name" : "remeber rcc as attribute",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1325,
        "layoutY" : 128
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ "slope", "intercept" ],
        "latestTsKeyNames" : [ ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1766999341977,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "6e79f5d0-cdfa-11f0-8f75-a755c2118e96"
      },
      "name" : "scaling attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1676,
        "layoutY" : 130
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "function round4(x) {\n    return Math.round(x * 10000.0) / 10000.0;\n}\n\nif (metadata.ss_slope != null && metadata.ss_intercept != null) {\n    msg.r = round4((metadata.ss_slope*msg.r) + metadata.ss_intercept);\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1766999323024,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "6e79f5d1-cdfa-11f0-8f75-a755c2118e96"
      },
      "name" : "clicks to mm",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1325,
        "layoutY" : 252
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.r > 0;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1766999044687,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "6e79f5d2-cdfa-11f0-8f75-a755c2118e96"
      },
      "name" : "have rainfall?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    } ],
    "ruleChainConnections" : null
  },
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}