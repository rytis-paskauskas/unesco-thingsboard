{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : "Author: Rytis Paškauskas"
    },
    "configuration" : null,
    "debugMode" : true,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "d2f89e44-b297-11f0-8f75-a755c2118e96"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "274b2930-b28f-11f0-8f75-a755c2118e96"
    },
    "name" : "Barani Meteo Wind decoder",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 16,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Post attributes"
    }, {
      "fromIndex" : 2,
      "toIndex" : 3,
      "type" : "RPC Request from Device"
    }, {
      "fromIndex" : 2,
      "toIndex" : 4,
      "type" : "Other"
    }, {
      "fromIndex" : 2,
      "toIndex" : 5,
      "type" : "RPC Request to Device"
    }, {
      "fromIndex" : 2,
      "toIndex" : 10,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 2,
      "toIndex" : 11,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 6,
      "toIndex" : 2,
      "type" : "False"
    }, {
      "fromIndex" : 6,
      "toIndex" : 7,
      "type" : "True"
    }, {
      "fromIndex" : 6,
      "toIndex" : 14,
      "type" : "False"
    }, {
      "fromIndex" : 6,
      "toIndex" : 14,
      "type" : "True"
    }, {
      "fromIndex" : 7,
      "toIndex" : 2,
      "type" : "False"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "True"
    }, {
      "fromIndex" : 8,
      "toIndex" : 2,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 6,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 12,
      "type" : "True"
    }, {
      "fromIndex" : 12,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 13,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 15,
      "type" : "Failure"
    } ],
    "firstNodeIndex" : 9,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1179,
        "layoutY" : 505
      },
      "configuration" : {
        "defaultTTL" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f87730-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Save Timeseries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 802,
        "layoutY" : 706
      },
      "configuration" : {
        "scope" : "SERVER_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : false
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f87731-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Save Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 401,
        "layoutY" : 405
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f87732-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Message Type Switch",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 802,
        "layoutY" : 304
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f87733-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Log RPC from Device",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 803,
        "layoutY" : 104
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f87734-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Log Other",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 803,
        "layoutY" : 204
      },
      "configuration" : {
        "timeoutInSeconds" : 60
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f89e40-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "RPC Call Request",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rpc.TbSendRPCRequestNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 51,
        "layoutY" : 406
      },
      "configuration" : {
        "originatorTypes" : [ "ENTITY_GROUP" ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f89e41-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Is Entity Group",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbOriginatorTypeFilterNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 51,
        "layoutY" : 506
      },
      "configuration" : {
        "messageTypes" : [ "POST_ATTRIBUTES_REQUEST", "RPC_CALL_FROM_SERVER_TO_DEVICE" ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f89e42-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Post attributes or RPC request",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeFilterNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 402,
        "layoutY" : 508
      },
      "configuration" : {
        "entityGroupId" : null,
        "entityGroupIsMessageOriginator" : true
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f89e43-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Duplicate To Group Entities",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbDuplicateMsgToGroupNode"
    }, {
      "additionalInfo" : {
        "description" : "Process incoming messages from devices with the alarm rules defined in the device profile. Dispatch all incoming messages with \"Success\" relation type.",
        "layoutX" : 51,
        "layoutY" : 306
      },
      "configuration" : {
        "persistAlarmRulesState" : false,
        "fetchAlarmRulesStateOnStart" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f89e44-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "Device Profile Node",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.profile.TbDeviceProfileNode"
    }, {
      "additionalInfo" : {
        "description" : "\nTranscribed to TBEL from https://github.com/Milesight-IoT/SensorDecoders/blob/main/ft-series/ft101/ft101-decoder.js\n",
        "layoutX" : 802,
        "layoutY" : 403
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "var decoded = {};\nvar b64 = msg.data;\n\n// Base64 → binary string\nvar binaryStr = atob(b64);\n\n// Binary string → byte array\nvar bytes = new Uint8Array(binaryStr.length);\nfor (var i = 0; i < binaryStr.length; i++) {\n    bytes[i] = binaryStr.charCodeAt(i) & 0xFF;\n}\n\ndecoded.bytes= bytes;\n\n\nreturn {msg: decoded, metadata: metadata, msgType: msgType};",
        "tbelScript" : "// {\"data\": \"y8IBcFhN/PpGIA==\", \"fport\": 1}\n\nvar decoded = decodeToJson(\"{}\");\n\n\n// ---------- Stateful BitReader (MSB-first) for base64 payloads ----------\n// Keeps reading position between bitReader() calls within same script execution.\n\nvar __br_bytes = null;   // Uint8Array of payload bytes\nvar __br_bitPos = 0;     // Bit position within the stream\n\n// Initialize the reader with base64 payload string.\n// Returns total bits available.\nfunction bitReaderInit(b64) {\n    __br_bytes = base64ToBytes(b64);  // ThingsBoard TBEL built-in\n    __br_bitPos = 0;\n    return __br_bytes.length * 8;\n}\n\n// Read N bits from LEFT (MSB-first) and return as unsigned integer\nfunction bitReader(N) {\n    if (__br_bytes == null) {\n        throw \"bitReaderInit() must be called first.\";\n    }\n    if (N <= 0) return 0;\n\n    var totalBits = __br_bytes.length * 8;\n    if (__br_bitPos + N > totalBits) {\n        throw \"Not enough bits remaining: requested \" + N + \", available \" + (totalBits - __br_bitPos);\n    }\n\n    var value = 0;\n    for (var i = 0; i < N; i++) {\n        var bitIndex  = __br_bitPos;\n        var byteIndex = bitIndex >> 3;\n        var bitInByte = 7 - (bitIndex & 7);    // MSB-first\n        var byteVal   = __br_bytes[byteIndex];\n        var bit       = (byteVal >> bitInByte) & 1;\n\n        value = (value << 1) | bit;\n        __br_bitPos = __br_bitPos + 1;\n    }\n\n    return value >>> 0; // unsigned\n}\n\nfunction bitsRemaining() {\n    if (__br_bytes == null) return 0;\n    return __br_bytes.length * 8 - __br_bitPos;\n}\n\nfunction round1(x) {\n    return Math.round(x * 10) / 10.0;\n}\n\nfunction round2(x) {\n    return Math.round(x * 100) / 100.0;\n}\n\n// ==== main body ===\nvar totalBits = bitReaderInit(msg.data);\nvar indx;\nvar batt;\nvar ws;     // wind speed\nvar wsx;    // wind gust speed\nvar wsm;    // wind speed minimum\nvar wssd;   // wind speed standard deviation\nvar wd;     // wind direction\nvar wdx;    // gust direction\nvar wdsd;   // wind direction standard deviation\nvar wxt;    // wind gust time\n\nif ((totalBits == 80) || (totalBits == 96)) {\n    // 10 or 12 byte meteoWind\n    indx = bitReader(8);\n    batt = round1(3 + 0.2*bitReader(3));\n    ws = round1(0.1*bitReader(9));\n    wsx = round1(ws + 0.1*bitReader(9));\n    wsm = round1(ws - 0.1*bitReader(9));\n    wssd = round1(0.1*bitReader(8));\n    wd = bitReader(9);\n    wdx = bitReader(9);\n    wdsd = bitReader(7);\n    wxt = 5*bitReader(7);\n} else if (totalBits == 72) {\n    // 9 byte payload\n    var type = bitReader(2);\n    batt = round1(3.0 + 0.05*bitReader(5));\n    ws = round1(0.1*bitReader(9));\n    wsx = round1(ws + 0.1*bitReader(9));\n    wsm = round1(ws - 0.1*bitReader(9));\n    wd = bitReader(9);\n    wdx = bitReader(9);\n    var dir_hi = bitReader(8);\n    var dir_lo = bitReader(8);\n    if(dir_hi >= 0 && dir_lo >= 0) {\n        wdsd = dir_hi + dir_lo;\n    } else {\n        if (dir_hi >= dir_lo) {\n            wdsd = dir_hi - dir_lo;\n        } else {\n            wdsd = 360 + dir_hi - dir_lo;\n        }\n    }\n}\n\n\nreturn {\n    msg: {\n        //bits: totalBits,\n        ws: ws,\n        wsx: wsx,\n        wsm: wsm,\n        wssd: wssd,\n        wd: wd,\n        wdx: wdx,\n        wdsd: wdsd\n    },\n    metadata: metadata,\n    msgType: msgType\n};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763479408446,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f89e45-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "decode base64",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 802,
        "layoutY" : 504
      },
      "configuration" : {
        "messageNames" : [ "attributes" ],
        "metadataNames" : [ ],
        "checkAllKeys" : true
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f8c550-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "got attribute data?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbCheckMessageNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 801,
        "layoutY" : 604
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "msg = msg.attributes;\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f8c551-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "prepare attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1176,
        "layoutY" : 405
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "if (msg.attributes != null) {\n    msg.remove(\"attributes\");\n}\nif (msg.info != null) {\n    msg.remove(\"info\");\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d2f8c552-b297-11f0-8f75-a755c2118e96"
      },
      "name" : "prepare telemetry",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 404,
        "layoutY" : 303
      },
      "configuration" : {
        "tellFailureIfAbsent" : false,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ "inactivityTimeout" ],
        "latestTsKeyNames" : [ ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "cdac3b20-b762-11f0-8f75-a755c2118e96"
      },
      "name" : "test for inactivityTimeout",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 404,
        "layoutY" : 200
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "msg={'inactivityTimeout':3660000};\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n//return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "cdac3b21-b762-11f0-8f75-a755c2118e96"
      },
      "name" : "set inactivity timeout",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1177,
        "layoutY" : 601
      },
      "configuration" : {
        "event" : "ACTIVITY_EVENT"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "69e18cc0-b763-11f0-8f75-a755c2118e96"
      },
      "name" : "Make it active",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbDeviceStateNode"
    } ],
    "ruleChainConnections" : null
  },
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}