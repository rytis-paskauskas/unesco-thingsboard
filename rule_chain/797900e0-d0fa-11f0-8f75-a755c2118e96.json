{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : "Author: Rytis Paškauskas\nAccording to Technical Support This is MeteoWind IoT Pro Github version"
    },
    "configuration" : null,
    "debugMode" : true,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "79a65272-d0fa-11f0-8f75-a755c2118e96"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "797900e0-d0fa-11f0-8f75-a755c2118e96"
    },
    "name" : "Barani Meteo Wind decoder Github",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 16,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Post attributes"
    }, {
      "fromIndex" : 2,
      "toIndex" : 3,
      "type" : "RPC Request from Device"
    }, {
      "fromIndex" : 2,
      "toIndex" : 4,
      "type" : "Other"
    }, {
      "fromIndex" : 2,
      "toIndex" : 5,
      "type" : "RPC Request to Device"
    }, {
      "fromIndex" : 2,
      "toIndex" : 10,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 2,
      "toIndex" : 11,
      "type" : "Post telemetry"
    }, {
      "fromIndex" : 6,
      "toIndex" : 2,
      "type" : "False"
    }, {
      "fromIndex" : 6,
      "toIndex" : 7,
      "type" : "True"
    }, {
      "fromIndex" : 6,
      "toIndex" : 14,
      "type" : "False"
    }, {
      "fromIndex" : 6,
      "toIndex" : 14,
      "type" : "True"
    }, {
      "fromIndex" : 7,
      "toIndex" : 2,
      "type" : "False"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "True"
    }, {
      "fromIndex" : 8,
      "toIndex" : 2,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 6,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 12,
      "type" : "True"
    }, {
      "fromIndex" : 12,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 13,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 15,
      "type" : "Failure"
    } ],
    "firstNodeIndex" : 9,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 1179,
        "layoutY" : 505
      },
      "configuration" : {
        "defaultTTL" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a60450-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Save Timeseries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 802,
        "layoutY" : 706
      },
      "configuration" : {
        "scope" : "SERVER_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : false
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a62b60-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Save Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : null,
        "layoutX" : 401,
        "layoutY" : 405
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a62b61-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Message Type Switch",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeSwitchNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 802,
        "layoutY" : 304
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a62b62-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Log RPC from Device",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 803,
        "layoutY" : 104
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nIncoming message:\\n' + JSON.stringify(msg) + '\\nIncoming metadata:\\n' + JSON.stringify(metadata);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a62b63-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Log Other",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 803,
        "layoutY" : 204
      },
      "configuration" : {
        "timeoutInSeconds" : 60
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a62b64-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "RPC Call Request",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rpc.TbSendRPCRequestNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 51,
        "layoutY" : 406
      },
      "configuration" : {
        "originatorTypes" : [ "ENTITY_GROUP" ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a62b65-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Is Entity Group",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbOriginatorTypeFilterNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 51,
        "layoutY" : 506
      },
      "configuration" : {
        "messageTypes" : [ "POST_ATTRIBUTES_REQUEST", "RPC_CALL_FROM_SERVER_TO_DEVICE" ]
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a65270-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Post attributes or RPC request",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbMsgTypeFilterNode"
    }, {
      "additionalInfo" : {
        "layoutX" : 402,
        "layoutY" : 508
      },
      "configuration" : {
        "entityGroupId" : null,
        "entityGroupIsMessageOriginator" : true
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a65271-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Duplicate To Group Entities",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbDuplicateMsgToGroupNode"
    }, {
      "additionalInfo" : {
        "description" : "Process incoming messages from devices with the alarm rules defined in the device profile. Dispatch all incoming messages with \"Success\" relation type.",
        "layoutX" : 51,
        "layoutY" : 306
      },
      "configuration" : {
        "persistAlarmRulesState" : false,
        "fetchAlarmRulesStateOnStart" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a65272-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Device Profile Node",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.profile.TbDeviceProfileNode"
    }, {
      "additionalInfo" : {
        "description" : "\nTranscribed to TBEL from https://github.com/Milesight-IoT/SensorDecoders/blob/main/ft-series/ft101/ft101-decoder.js\n",
        "layoutX" : 802,
        "layoutY" : 403
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "var decoded = {};\nvar b64 = msg.data;\n\n// Base64 → binary string\nvar binaryStr = atob(b64);\n\n// Binary string → byte array\nvar bytes = new Uint8Array(binaryStr.length);\nfor (var i = 0; i < binaryStr.length; i++) {\n    bytes[i] = binaryStr.charCodeAt(i) & 0xFF;\n}\n\ndecoded.bytes= bytes;\n\n\nreturn {msg: decoded, metadata: metadata, msgType: msgType};",
        "tbelScript" : "// {\"data\": \"RoMgXBwGFQWVkGwA\", \"fport\": 1}\n\nvar slope = 0.6335;\nvar icept = 0.3582;\n\nvar decoded = decodeToJson(\"{}\");\n\n\n// ---------- Stateful BitReader (MSB-first) for base64 payloads ----------\n// Keeps reading position between bitReader() calls within same script execution.\n\nvar __br_bytes = null;   // Uint8Array of payload bytes\nvar __br_bitPos = 0;     // Bit position within the stream\n\n// Initialize the reader with base64 payload string.\n// Returns total bits available.\nfunction bitReaderInit(b64) {\n    __br_bytes = base64ToBytes(b64);  // ThingsBoard TBEL built-in\n    __br_bitPos = 0;\n    return __br_bytes.length * 8;\n}\n\n// Read N bits from LEFT (MSB-first) and return as unsigned integer\nfunction bitReader(N) {\n    if (__br_bytes == null) {\n        throw \"bitReaderInit() must be called first.\";\n    }\n    if (N <= 0) return 0;\n\n    var totalBits = __br_bytes.length * 8;\n    if (__br_bitPos + N > totalBits) {\n        throw \"Not enough bits remaining: requested \" + N + \", available \" + (totalBits - __br_bitPos);\n    }\n\n    var value = 0;\n    for (var i = 0; i < N; i++) {\n        var bitIndex  = __br_bitPos;\n        var byteIndex = bitIndex >> 3;\n        var bitInByte = 7 - (bitIndex & 7);    // MSB-first\n        var byteVal   = __br_bytes[byteIndex];\n        var bit       = (byteVal >> bitInByte) & 1;\n\n        value = (value << 1) | bit;\n        __br_bitPos = __br_bitPos + 1;\n    }\n\n    return value >>> 0; // unsigned\n}\n\nfunction bitsRemaining() {\n    if (__br_bytes == null) return 0;\n    return __br_bytes.length * 8 - __br_bitPos;\n}\n\nfunction round1(x) {\n    return Math.round(x * 10) / 10.0;\n}\n\nfunction round2(x) {\n    return Math.round(x * 100) / 100.0;\n}\n\n// ==== main body ===\nvar totalBits = bitReaderInit(msg.data);\nvar tmp;\nvar indx;\nvar batt;\nvar ws;     // wind speed\nvar wssd;   // wind speed standard deviation\nvar wsx1s;    // wind gust speed\nvar wsx3s;\nvar wsm3s;  // wind speed minimum\nvar wd;     // wind direction\nvar wdsd;   // wind direction standard deviation\nvar wdx1s;    // gust direction\n\nif ((totalBits >= 96)) {\n    // 12+ byte meteoWind. Adapted \"Gen2\" decoder from:\n    // https://github.com/barani-design/P_SRC_device_decoders/blob/main/Lora_and_SigFox_Devices/MeteoWind_IoT_Pro_Gen2/MeteoWind_IoT_Pro_Gen2_FW_1.02.00x.js\n//| name         | bits | total | renamed |\n//|--------------+------+-------|---------+\n//| idx          |    8 |     8 | indx\n//| Vbat         |    1 |     9 | batt\n//| Hz_avg       |   12 |    21 | ws\n//| Hz_3s_gust   |    9 |    30 | wsx3s\n//| Hz_1s_gust   |    8 |    38 | wsx1s\n//| Hz_3s_min    |    9 |    47 | wsm\n//| Hz_1s_stdev  |    8 |    55 | wssd\n//| Deg_1s_avg   |    9 |    64 | wd\n//| Deg_1s_gust  |    9 |    73 | wdx\n//| Deg_1s_stdev |    8 |    81 | wdsd\n//| Deg_ccw_min  |    9 |    90 | -\n//| Deg_ccw_max  |    9 |    99 | -\n//| Time_1s_gust |    7 |   106 | -\n//| Alarm sent   |    1 |   107 | -\n//| Debug flags  |    5 |   112 | -\n\n    indx = bitReader(8);\n    \n    batt = round1(3.2 + 0.2*bitReader(1));\n    \n    tmp = 0.02*bitReader(12);\n    ws = tmp > 0 ? round2(slope*tmp + icept) : 0.0;\n    \n    tmp = tmp + 0.1*bitReader(9);\n    wsx3s = tmp > 0 ? round2(slope*tmp + icept) : 0.0;\n    \n    tmp = tmp + 0.1*bitReader(8);\n    wsx1s = tmp > 0 ? round2(slope*tmp + icept) : 0.0;\n    \n    tmp = 0.1*bitReader(9);\n    wsm3s = tmp > 0 ? round2(slope*tmp + icept) : 0.0;\n    \n    wssd = round2(0.1*bitReader(8));\n    \n    wd = bitReader(9);\n    wdx1s = bitReader(9);\n    wdsd = bitReader(8);\n}\n\n\nreturn {\n    msg: {\n        //bits: totalBits,\n        ws: ws,\n        wsx1s: wsx1s,\n        wsx3s: wsx3s,\n        wsm3s: wsm3s,\n        wssd: wssd,\n        wd: wd,\n        wdsd: wdsd,\n        wdx1s: wdx1s\n    },\n    metadata: metadata,\n    msgType: msgType\n};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763479408446,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a65273-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "decode base64",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 802,
        "layoutY" : 504
      },
      "configuration" : {
        "messageNames" : [ "attributes" ],
        "metadataNames" : [ ],
        "checkAllKeys" : true
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a65274-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "got attribute data?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbCheckMessageNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 801,
        "layoutY" : 604
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "msg = msg.attributes;\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a65275-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "prepare attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1176,
        "layoutY" : 405
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "if (msg.attributes != null) {\n    msg.remove(\"attributes\");\n}\nif (msg.info != null) {\n    msg.remove(\"info\");\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a65276-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "prepare telemetry",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 404,
        "layoutY" : 303
      },
      "configuration" : {
        "tellFailureIfAbsent" : false,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ "inactivityTimeout" ],
        "latestTsKeyNames" : [ ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a67980-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "test for inactivityTimeout",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 404,
        "layoutY" : 200
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "msg={'inactivityTimeout':3660000};\nmsgType = \"POST_ATTRIBUTES_REQUEST\";\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n//return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a67981-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "set inactivity timeout",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1177,
        "layoutY" : 601
      },
      "configuration" : {
        "event" : "ACTIVITY_EVENT"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "79a67982-d0fa-11f0-8f75-a755c2118e96"
      },
      "name" : "Make it active",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbDeviceStateNode"
    } ],
    "ruleChainConnections" : null
  },
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}